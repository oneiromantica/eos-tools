"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.BitFieldBase=undefined;var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err){_d=true;_e=err;}finally{try{if(!_n&&_i["return"])_i["return"]();}finally{if(_d)throw _e;}}return _arr;}return function(arr,i){if(Array.isArray(arr)){return arr;}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i);}else{throw new TypeError("Invalid attempt to destructure non-iterable instance");}};}();var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj;}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};var _BaseConvert=require("./BaseConvert");var _BaseConvert2=_interopRequireDefault(_BaseConvert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i];}return arr2;}else{return Array.from(arr);}}
var assert=function assert(typename,test){return function(value){if(!test(value))throw new Error("Expected ["+typename+"], received "+(typeof value==="undefined"?"undefined":_typeof(value))+" "+JSON.stringify(value));};};var isNaturalNumber=function isNaturalNumber(x){return typeof x==="number"&&x>=0;};var assertIsNaturalNumber=assert("integer >= 0",isNaturalNumber);var BitFieldBase=exports.BitFieldBase=function BitFieldBase(){var L=arguments.length>0&&arguments[0]!==undefined?arguments[0]:6;var idces=[].concat(_toConsumableArray(Array(L))).map(function(_,idx){return 1<<idx;});var isBitField=function isBitField(x){return Array.isArray(x)&&x.every(function(field){return typeof field==="number";})&&x.length>0;};var getCoords=function getCoords(n,bits){assertIsNaturalNumber(n);assert("input is bit field",isBitField)(bits);var nMax=bits.length*L-1;assert("address is number between 0 and "+nMax,function(x){return x<=nMax;})(n);var bucket=Math.floor(n/L);var index=n%L;return[bucket,index];};var getAtCoords=function getAtCoords(bucket,index,bits){return bits[bucket]&idces[index]?true:false;};var getAt=function getAt(n,bits){var _getCoords=getCoords(n,bits),_getCoords2=_slicedToArray(_getCoords,2),bucket=_getCoords2[0],index=_getCoords2[1];return getAtCoords(bucket,index,bits);};var setAt=function setAt(n,bits){var _getCoords3=getCoords(n,bits),_getCoords4=_slicedToArray(_getCoords3,2),bucket=_getCoords4[0],index=_getCoords4[1];return bits.map(function(b,idx){return idx===bucket?b|idces[index]:b;});};var clearAt=function clearAt(n,bits){var _getCoords5=getCoords(n,bits),_getCoords6=_slicedToArray(_getCoords5,2),bucket=_getCoords6[0],index=_getCoords6[1];var isSet=getAtCoords(bucket,index,bits);return isSet?bits.map(function(b,idx){return idx===bucket?b^idces[index]:b;}):bits;};var of=function of(nFlags){assertIsNaturalNumber(nFlags);var spaces=Math.max(Math.floor((nFlags-1)/L)+1,1);return[].concat(_toConsumableArray(Array(spaces))).map(function(_){return 0;});};var toBase65=function toBase65(bits){var encoded=bits.map(_BaseConvert2.default.encode);return L<7?encoded.join(""):encoded.join(",");};var fromBase65=function fromBase65(str){return(L<7?str.split(""):str.split(",")).map(_BaseConvert2.default.decode);};var count=function count(bits){var l=bits.length*L;var setBits=0;for(var i=0;i<l;i++){if(getAt(i,bits))setBits++;}return setBits;};return{of:of,getAt:getAt,setAt:setAt,clearAt:clearAt,toBase65:toBase65,fromBase65:fromBase65,count:count};};window&&(window.BitField=BitFieldBase());exports.default=BitFieldBase();